# AXON（文系レポ助）開発ロードマップ

## 現状の実装状況

### 実装済み機能 ✅
- ✅ 基本的なレポート構成生成（テンプレートベース）
- ✅ 分野別テンプレート（文学・法学・哲学・社会学・歴史学）
- ✅ 指導教員タイプによる重み付け
- ✅ 「前回の続きから生成」機能（既存構成保持 + セクション別論点追加）
- ✅ 生成意図選択（論点追加、視点変更、理論寄り、実務寄り、具体例追加、反論考慮）
- ✅ 共有機能（リンク共有、SNSシェア）
- ✅ NextAuth.jsによるEmail認証（マジックリンク）
- ✅ 生成回数制限（未ログイン：1日1回、Free：1日5回、Pro：無制限）
- ✅ マイページ（履歴管理、分野別グループ化）
- ✅ レポート構成の保存機能（Supabase）

---

## 次期機能実装ロードマップ

このロードマップは、思考の積み上げを支援するUXを提供し、「個人ツール」から「学内で使われる構造合意ツール」への進化を実現することを目的としています。

---

## 次期機能実装ロードマップ

### Phase 1: コアUX向上（優先度：高）📌

#### 1. コメント反映型生成
**優先度**: ⭐⭐⭐ 高（MVP完成後の最初の拡張機能）

**実装ポイント**:
- **入力UI**: セクションごとにコメント入力欄を追加
  - 教授のコメント入力フォーム
  - 友達のフィードバック入力フォーム
  - 既存論点に対するコメント（どの論点に対するコメントかを選択）
- **AI処理**: `generateAdditionalPoints`を拡張し、コメントを考慮した論点生成
  - コメントの内容を解析（批判・追加要求・修正指示など）
  - 既存論点を削除/修正/追加の判断
  - テンプレートベースでコメントに応じた論点を生成
- **出力UI**: 
  - 「修正前/修正後」の比較表示
  - 変更点をハイライト表示
  - コメントに対する対応状況を表示

**UI例**:
```
┌─────────────────────────────────────────┐
│ コメント反映型生成                       │
├─────────────────────────────────────────┤
│ 対象セクション: [本論 ▼]                │
│                                         │
│ コメント入力:                           │
│ ┌───────────────────────────────────┐  │
│ │ 文体分析が弱い。修辞技法の分析も  │  │
│ │ 追加してほしい。                  │  │
│ └───────────────────────────────────┘  │
│ コメントタイプ: [批判 ▼] [追加要求▼]  │
│                                         │
│ [修正版を生成する]                      │
└─────────────────────────────────────────┘

修正後:
- テクストの構造分析と解釈の根拠提示
- 修辞技法の分析と意味生成への影響      ← 追加
- 文体の特徴と解釈の妥当性検証          ← 修正
```

**技術実装**:
- `app/actions/generatePointsFromComment.ts` を作成
- コメント解析ロジック（キーワード抽出：批判、追加、修正、削除など）
- 既存論点とコメントの関連付け

**Free/Pro差別化**:
- **Free**: 1つのセクションに対して1回のみコメント反映可能
- **Pro**: 無制限のコメント反映、複数セクション同時対応

---

#### 2. 段階的アウトライン拡張
**優先度**: ⭐⭐⭐ 高（思考の積み上げを実現する核心機能）

**実装ポイント**:
- **段階管理**: 生成ステージを `level` として保存
  - Level 1: 基本構成（序論・本論・結論の大枠のみ）
  - Level 2: 詳細論点追加（各セクションの論点を展開）
  - Level 3: 具体例・引用・脚注追加（実装時に詳細化）
- **UI**: 「次のレベルに拡張」ボタンを各段階で表示
  - 現在のレベルを表示（例：Level 2/3）
  - プログレスバーで視覚化
- **データ構造**: `ReportOutline`に`level`と`previousLevelOutline`を追加

**UI例**:
```
┌─────────────────────────────────────────┐
│ レポート構造 [Level 2/3]                │
│ ████████░░ 67% 完了                     │
├─────────────────────────────────────────┤
│ 序論                                    │
│ • 作品の歴史的・文化的文脈の整理        │
│ • 先行研究における解釈の対立点の明確化  │
│                                         │
│ 本論                                    │
│ • テクストの構造分析と解釈の根拠提示    │
│ • 表現技法と意味生成の関係性の考察      │
│                                         │
│ [Level 3に拡張] ← 具体例・引用を追加    │
└─────────────────────────────────────────┘
```

**技術実装**:
- `designOutline`を拡張して`level`パラメータを受け取る
- Level 2: 既存の論点生成（実装済み）
- Level 3: 具体例テンプレートを追加（新規作成が必要）

**Free/Pro差別化**:
- **Free**: Level 2まで（詳細論点まで）
- **Pro**: Level 3まで（具体例・引用・脚注まで）

---

#### 4. セクション単位の再生成
**優先度**: ⭐⭐⭐ 高（「前回の続きから生成」の拡張）

**実装ポイント**:
- **既存機能の拡張**: 「前回の続きから生成」を基盤に
  - 現在は「論点追加」のみ → 「完全再生成」オプションを追加
  - 「論点を置き換える」vs「論点を追加する」の選択
- **コメント反映**: セクション単位でコメントを入力して再生成
- **UI**: 各セクションに「再生成」ボタンを追加
  - モーダルで再生成オプションを選択
    - [ ] 既存論点を保持して追加
    - [ ] 既存論点を置き換える
    - [x] コメントを反映する

**UI例**:
```
┌─────────────────────────────────────────┐
│ 本論 [再生成]                            │
├─────────────────────────────────────────┤
│ 現在の論点:                             │
│ • テクストの構造分析...                 │
│ • 表現技法と意味生成...                 │
│                                         │
│ 再生成オプション:                       │
│ ☑ 既存論点を保持して追加                │
│ ☐ 既存論点を置き換える                  │
│ ☑ コメントを反映する                    │
│                                         │
│ コメント: [教授: 実例が不足...]         │
│                                         │
│ [再生成する]                            │
└─────────────────────────────────────────┘
```

**技術実装**:
- `handleContinueGeneration`を拡張
- オプションに応じて論点を追加/置換
- コメント入力欄を追加

**Free/Pro差別化**:
- **Free**: 各セクション1日1回まで再生成可能
- **Pro**: 無制限再生成、コメント履歴の保存

---

### Phase 2: 可視化・追跡機能（優先度：中）📊

#### 3. 履歴差分表示
**優先度**: ⭐⭐ 中（UX向上、思考プロセスの可視化）

**実装ポイント**:
- **差分計算**: 前回の構成と現在の構成を比較
  - 追加された論点（緑色でハイライト）
  - 削除された論点（赤色で打ち消し線）
  - 修正された論点（黄色でハイライト）
- **UI**: 「変更履歴を表示」ボタン
  - タイムライン形式で変更履歴を表示
  - 「前回の続きから生成」で追加された論点を自動記録
- **データ構造**: `ReportOutline`に`version`と`parentVersionId`を追加

**UI例**:
```
┌─────────────────────────────────────────┐
│ 変更履歴 [前回から続き生成]              │
├─────────────────────────────────────────┤
│ 本論（変更あり）                         │
│                                         │
│ + 修辞技法の分析と意味生成への影響      │ ← 追加
│ - 表現技法と意味生成の関係性の考察      │ ← 削除
│ ~ テクストの構造分析...                 │ ← 修正
│   → テクストの構造分析と修辞技法の      │
│      統合的解釈                          │
└─────────────────────────────────────────┘
```

**技術実装**:
- `app/utils/diffOutline.ts` を作成（差分計算ユーティリティ）
- マイページで履歴をバージョン管理
- 履歴ビューアーコンポーネントを作成

**Free/Pro差別化**:
- **Free**: 最新2バージョンのみ比較可能
- **Pro**: 全履歴の比較、エクスポート可能

---

#### 7. AIによる論点分類
**優先度**: ⭐⭐ 中（高度な検索・フィルタリング機能）

**実装ポイント**:
- **タグ付け**: 各論点に自動タグ付け
  - タグ例: `理論`, `実務`, `歴史`, `比較`, `事例`, `反論`, `定義`, `分析`
- **フィルタリング**: タグで論点を絞り込み
- **再生成**: 特定のタグの論点のみ再生成可能
- **UI**: タグバッジを表示、クリックでフィルタ

**UI例**:
```
┌─────────────────────────────────────────┐
│ 本論                                    │
├─────────────────────────────────────────┤
│ [理論] [分析] テクストの構造分析...     │
│ [実務] [事例] 具体的な作品例の検討...   │
│ [比較] [分析] 同時代作品との比較...     │
│                                         │
│ タグで絞り込み: [理論▼] [実務▼] [全表示] │
│                                         │
│ [選択したタグの論点を再生成]            │
└─────────────────────────────────────────┘
```

**技術実装**:
- `app/utils/classifyPoints.ts` を作成（タグ付けロジック）
- キーワードマッチングでタグを自動付与
- フィルタリングUIコンポーネント

**Free/Pro差別化**:
- **Free**: タグ表示のみ（フィルタリング不可）
- **Pro**: タグによるフィルタリング、タグ別再生成、カスタムタグ

---

### Phase 3: コラボレーション機能（優先度：中～高）👥

#### 6. チーム共有・共同編集
**優先度**: ⭐⭐⭐ 高（学内での使用を想定した重要機能）

**実装ポイント**:
- **共有権限**: 
  - `view` (閲覧のみ)
  - `comment` (コメント可能)
  - `edit` (編集可能、論点追加可能)
- **コメント機能**: 
  - 各論点に対してコメントを追加
  - コメント者は名前・メールで識別（匿名も可）
- **通知機能**: 
  - 新しいコメント・編集があった場合に通知
  - Email通知（オプション）
- **UI**: 
  - 共有設定モーダル（権限選択）
  - コメント表示UI（各論点の下に表示）
  - 「他ユーザーの追記を含めて続き生成」チェックボックス

**UI例**:
```
┌─────────────────────────────────────────┐
│ 本論 [共有中] [3人のコメント]            │
├─────────────────────────────────────────┤
│ • テクストの構造分析...                 │
│   ┌─ コメント ─────────────────────┐   │
│   │ 👤 田中さん: もう少し具体例が  │   │
│   │    欲しいです                   │   │
│   │ 👤 教授: 修辞技法も検討して    │   │
│   └────────────────────────────────┘   │
│                                         │
│ [コメントを追加]                        │
└─────────────────────────────────────────┘
```

**技術実装**:
- Supabaseに`shared_reports`テーブルを作成
- `report_comments`テーブルを作成
- リアルタイム更新（Supabase Realtime）の検討

**Free/Pro差別化**:
- **Free**: 5人まで共有可能、コメントのみ
- **Pro**: 無制限共有、共同編集、通知機能

---

### Phase 4: 高度な機能（優先度：中）📚

#### 5. 参考文献サジェスト連携
**優先度**: ⭐⭐ 中（Pro版の価値向上）

**実装ポイント**:
- **論点との関連付け**: 生成した論点に対して関連文献を提案
  - 論点のキーワードから文献カテゴリを推定
  - 分野別の文献データベース（JSON）を作成
- **UI**: 
  - 各論点の下に「関連文献」セクションを表示
  - 「この論点の文献を追加」ボタン
- **エクスポート連携**: PDF/Word出力時に参考文献リストを自動挿入

**UI例**:
```
┌─────────────────────────────────────────┐
│ 本論                                    │
├─────────────────────────────────────────┤
│ • テクストの構造分析...                 │
│   📚 関連文献:                          │
│   - 構造主義文学論（基礎理論）          │
│   - テクスト分析の方法（方法論）        │
│   [文献を追加]                          │
└─────────────────────────────────────────┘
```

**技術実装**:
- `app/data/references.json` を作成（分野別文献リスト）
- キーワードマッチングで関連文献を抽出
- PDF/Word出力機能（ライブラリ: `jsPDF`, `docx`）

**Free/Pro差別化**:
- **Free**: 文献リストの表示のみ（最大3件）
- **Pro**: 無制限文献、PDF/Word出力時に自動挿入、カスタム文献追加

---

## 実装優先順位とスケジュール案

### Sprint 1（2週間）: コアUX向上
1. ✅ **セクション単位の再生成**（既存機能の拡張）
   - 実装難易度: 低（既存コードを拡張）
   - 影響範囲: `handleContinueGeneration`, UI
   
2. ✅ **段階的アウトライン拡張（Level 2→3）**
   - 実装難易度: 中（具体例テンプレートの作成が必要）
   - 影響範囲: `designOutline`, `templates.json`, UI

### Sprint 2（2週間）: コメント機能
3. ✅ **コメント反映型生成**
   - 実装難易度: 高（コメント解析ロジックが複雑）
   - 影響範囲: 新規サーバーアクション、UI大幅変更

### Sprint 3（2週間）: 可視化・共有
4. ✅ **履歴差分表示**
   - 実装難易度: 中（差分計算アルゴリズム）
   - 影響範囲: ユーティリティ関数、マイページ

5. ✅ **チーム共有・共同編集（Phase 1）**
   - 実装難易度: 高（データベース設計、権限管理）
   - 影響範囲: Supabaseスキーマ、共有UI

### Sprint 4（2週間）: 高度な機能
6. ✅ **AIによる論点分類**
   - 実装難易度: 低～中（キーワードマッチング）
   - 影響範囲: ユーティリティ関数、UI

7. ✅ **参考文献サジェスト連携**
   - 実装難易度: 中（文献データベース、PDF/Word出力）
   - 影響範囲: データファイル、エクスポート機能

---

## Free/Pro差別化戦略

### Free版の価値提案
- 基本的なレポート構成生成（5回/日）
- 前回の続きから生成（1回/セクション/日）
- セクション単位再生成（1回/セクション/日）
- 履歴管理（最新2バージョン）
- 共有機能（5人まで、閲覧のみ）

### Pro版の価値提案（$9.90/月）
- 無制限の生成・再生成
- 段階的アウトライン拡張（Level 3まで）
- コメント反映型生成（無制限）
- 履歴管理（全バージョン、差分表示、エクスポート）
- チーム共有・共同編集（無制限、通知機能）
- 論点分類・フィルタリング
- 参考文献サジェスト（無制限、PDF/Word出力）
- 優先サポート

---

## 技術的考慮事項

### データベース拡張が必要な機能
- **コメント反映型生成**: `report_comments`テーブル
- **段階的アウトライン拡張**: `outline_level`カラム追加
- **履歴差分表示**: `outline_versions`テーブル（バージョン管理）
- **チーム共有**: `shared_reports`, `report_comments`テーブル
- **論点分類**: `point_tags`テーブル（タグ管理）

### パフォーマンス考慮
- 履歴差分計算はクライアント側で実行（サーバー負荷軽減）
- 論点分類は生成時に実行し、結果をキャッシュ
- 共有機能はリアルタイム更新ではなく、手動リロード方式（初期実装）

### セキュリティ考慮
- 共有レポートの権限チェック（サーバーサイド）
- コメント・編集の履歴追跡（改ざん防止）
- 個人情報の取り扱い（コメント者の匿名化オプション）

---

## UI/UX改善提案

### 統一デザイン言語
- モーダルの共通パターン化
- ボタンの状態表示（無効・ローディング・成功）
- エラーメッセージの統一

### アクセシビリティ
- キーボードナビゲーション対応
- スクリーンリーダー対応
- コントラスト比の確保

### モバイル対応
- レスポンシブデザインの徹底
- タッチ操作の最適化
- モーダルの全画面表示（モバイル）
